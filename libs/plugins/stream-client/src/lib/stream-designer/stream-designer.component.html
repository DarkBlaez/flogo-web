<div class="stream-header">
  <div class="stream-details" [ngClass]="{ '--hover': backToAppHover }">
    <i
      class="flogo-icon flogo-icon-back back-to-app"
      (click)="navigateToApp()"
      (mouseover)="onMouseOverBackControl()"
      (mouseout)="onMouseOutBackControl()"
    ></i>
    <div
      class="flogo-profile__tile profile__thumb flogo-profile__microservice-stream"
    ></div>
    <div class="details-content" *ngIf="flowState">
      <div
        class="details-name"
        [(fgContentEditable)]="flowState.name"
        (fgContentEditableChange)="changeFlowDetailName($event, 'name')"
      ></div>
      <span class="details-content__app-name">in</span>
      <span
        class="details-app-name details-content__app-name"
        (click)="navigateToApp()"
        (mouseover)="onMouseOverBackControl()"
        (mouseout)="onMouseOutBackControl()"
        >{{ flowState.app?.name }}</span
      >
      <p
        class="details-description"
        [(fgContentEditable)]="flowState.description"
        [allowNewLines]="true"
        placeholder="{{ 'CANVAS:ADD-STREAM-DESCRIPTION' | translate }}"
        (fgContentEditableChange)="changeFlowDetail($event, 'description')"
      ></p>
    </div>
  </div>
  <div class="menu-content" (fgClickOutside)="closeMenu()">
    <i
      class="flogo-icon-kebabmenu kebabmenu-icon menu-dropdown-kebab-menu"
      [class.active]="isMenuOpen"
      (click)="toggleMenu()"
    ></i>
    <div class="menu-dropdown" [class.active]="isMenuOpen">
      <ul class="menu-dropdown__list">
        <li class="menu-dropdown__item" (click)="deleteStream()">
          <i class="flogo-icon flogo-icon-delete"></i>{{ 'CANVAS:DELETE' | translate }}
        </li>
      </ul>
    </div>
  </div>
</div>
<flogo-context-panel-area
  [isOpen]="isPanelOpen"
  panelTitle="Stream Simulator"
  openHeight="60vh"
  (open)="togglePanel()"
  (close)="togglePanel()"
>
  <div class="main content-layout" context-panel-role="primary-area">
    <div class="content-layout__side">
      <flogo-stream-triggers></flogo-stream-triggers>
      <flogo-stream-params-schema-button
        [flowMetadata]="resourceMetadata"
        [groupBy]="flowState.groupBy"
        (click)="openMetadataModal()"
      ></flogo-stream-params-schema-button>
    </div>
    <div class="content-layout__main">
      <flogo-diagram
        diagramId="stream"
        [flow]="graph"
        [selection]="currentSelection"
        (action)="onDiagramAction($event)"
      ></flogo-diagram>
      <flogo-context-panel-trigger
        (open)="togglePanel()"
        title="Stream Simulator"
      ></flogo-context-panel-trigger>
    </div>
  </div>
  <div context-panel-role="panel-content">
    <!-- need to use ngTemplateOutlet for the component to be initialized/destroyed when the panel toggles its visibility -->
    <ng-container *ngTemplateOutlet="simulator"></ng-container>
  </div>

  <ng-template #simulator>
    <flogo-stream-simulator
      *ngIf="isPanelOpen"
      [metadata]="resourceMetadata"
    ></flogo-stream-simulator>
  </ng-template>
</flogo-context-panel-area>

<flogo-stream-params-schema
  #metadataModal
  [metadata]="resourceMetadata"
  [groupBy]="flowState.groupBy"
  (save)="onResourceMetadataSave($event)"
></flogo-stream-params-schema>
